{% extends "base_view.html" %}

{% block title %} University Laboratory Checkout System {% endblock %}

{% block content %}

<section class="hero">
  <h1 class="hero-title">University Laboratory Checkout System</h1>
  <p class="hero-desc">Track items, manage purchase orders, and keep a clear record of whatâ€™s in the lab.</p>
  <div class="actions">
    <a class="action" href="{% url 'inventory:new_order' %}">âž• Create New Order</a>
    <a class="action" href="{% url 'inventory:items' %}">ðŸ”Ž Browse &amp; Search Items</a>
    <a class="action" href="{% url 'inventory:orders' %}">ðŸ“¦ View All Orders</a>
    <a class="action" href="{% url 'admin:inventory_stockitem_changelist' %}">ðŸ“± QR Stock Items</a>
  </div>
</section>

<div style="height: 12px"></div>

<div class="card card-pad">
  <h2>Quick Links</h2>
  <ul>
    <li><a href="{% url 'inventory:unplaced-orders' %}">Unplaced (in-progress) orders</a></li>
    <li><a href="{% url 'inventory:incomplete-orders' %}">Placed orders with unreceived items</a></li>
    <li><a href="{% url 'inventory:orders' %}">All orders</a></li>
  </ul>

  <p>To order something, create an order and assign items to it. When an item is added to an order, enter per-order details like price and quantity. If an item doesn't exist yet, create it first, then add it to the order.</p>

  {% if stats %}
  <div class="stats">
    <div class="stat"><h3>Items</h3><div class="num">{{ stats.item_count }}</div></div>
    <div class="stat"><h3>Orders</h3><div class="num">{{ stats.order_count }}</div></div>
    <div class="stat"><h3>Unplaced</h3><div class="num">{{ stats.unplaced_count }}</div></div>
    <div class="stat"><h3>Incomplete</h3><div class="num">{{ stats.incomplete_count }}</div></div>
    <div class="stat"><h3>QR Items</h3><div class="num">{{ stats.stock_item_count }}</div></div>
    <div class="stat"><h3>Active Checkouts</h3><div class="num">{{ stats.active_checkouts }}</div></div>
  </div>
  {% endif %}

  <div class="grid" style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
    <div>
      <h3>Recent Orders</h3>
      <table class="table table-condensed">
        <thead>
          <tr><th>Name</th><th>Placed On</th><th>Items</th><th>Received</th></tr>
        </thead>
        <tbody>
          {% for o in recent_orders %}
          <tr>
            <td><a href="{{ o.get_absolute_url }}">{{ o.name }}</a> {% if o.placed_on %}<span class="badge badge-success">Placed</span>{% else %}<span class="badge badge-warning">In Progress</span>{% endif %}</td>
            <td>{{ o.placed_on|default:"â€”" }}</td>
            <td>{{ o.item_count }}</td>
            <td>{{ o.item_received_count }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4">No recent orders.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div>
      <h3>Recent Items</h3>
      <table class="table table-condensed">
        <thead>
          <tr><th>Name</th><th>Vendor</th><th>Catalog</th><th>Category</th></tr>
        </thead>
        <tbody>
          {% for i in recent_items %}
          <tr>
            <td><a href="{{ i.get_absolute_url }}">{{ i.name }}</a></td>
            <td>{{ i.vendor }}</td>
            <td>{{ i.catalog|default:"" }}</td>
            <td>{{ i.category }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4">No recent items.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div style="margin-top: 24px; padding: 16px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
    <h3 style="margin-top: 0;">ðŸ“± QR Quick Checkout</h3>
    <p style="color: #555;">Scan QR codes on lab equipment to quickly check out items. Each item has a unique QR code that links to a fast checkout page.</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
      <div>
        <h4 style="margin-bottom: 8px;">Available Stock Items</h4>
        {% if recent_stock_items %}
        <div style="display: grid; gap: 8px;">
          {% for item in recent_stock_items %}
          <div style="padding: 8px; background: white; border: 1px solid #ddd; border-radius: 4px;">
            <strong>{{ item.name }}</strong>
            {% if item.sku %}<br><small style="color: #666;">SKU: {{ item.sku }}</small>{% endif %}
            <br>
            <a href="{% url 'admin:inventory_stockitem_change' item.pk %}" style="font-size: 0.85em;">View QR Code</a>
            <a href="/quick-checkout/{{ item.qr_token }}/" style="font-size: 0.85em; margin-left: 8px;">Quick Checkout</a>
          </div>
          {% endfor %}
        </div>
        <div style="margin-top: 12px;">
          <a href="{% url 'admin:inventory_stockitem_changelist' %}" class="btn btn-sm">View All Stock Items â†’</a>
        </div>
        {% else %}
        <p style="color: #999;">No stock items yet. <a href="{% url 'admin:inventory_stockitem_add' %}">Add your first item</a></p>
        {% endif %}
      </div>

      <div>
        <h4 style="margin-bottom: 8px;">Recent Checkouts</h4>
        {% if recent_checkouts %}
        <table class="table table-condensed" style="font-size: 0.9em;">
          <thead>
            <tr><th>Item</th><th>Student</th><th>Due Date</th><th>Status</th></tr>
          </thead>
          <tbody>
            {% for co in recent_checkouts %}
            <tr>
              <td>{{ co.item.name }}</td>
              <td>{{ co.student.username }}</td>
              <td>{{ co.due_date|date:"M d" }}</td>
              <td>
                {% if co.status == 'out' %}
                <span class="badge badge-warning">Out</span>
                {% else %}
                <span class="badge badge-success">Returned</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div style="margin-top: 8px;">
          <a href="{% url 'admin:inventory_checkoutrecord_changelist' %}" class="btn btn-sm">View All Checkouts â†’</a>
        </div>
        {% else %}
        <p style="color: #999;">No checkouts yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
