{% extends "base_view.html" %}
{% load widget_tweaks %}

{% block title %} University Laboratory Checkout System : Order : {{ order.name }} {% endblock %}

{% block content %}

<h2>Order: {{ order.name }}
  {% if order.placed_on %}
    <span class="badge badge-success" title="Order placed on {{ order.placed_on }}">Placed</span>
  {% else %}
    <span class="badge badge-warning" title="Order is in progress">In Progress</span>
  {% endif %}
</h2>

<p class="hero-desc">Overview and current status for this purchase order.</p>

<dl class="dl-horizontal">
  <dt>created on</dt><dd>{{ order.created_at.date }}</dd>
  <dt>account(s)</dt><dd>{{ order.account_descriptions }}</dd>
  <dt>placed on</dt><dd>{{ order.placed_on|default_if_none:"(in progress)" }}</dd>
  <dt>requested by</dt><dd>{{ order.requested_by.get_full_name}}</dd>
  <dt>total cost</dt><dd>{{ order.total_cost }}</dd>
</dl>

<h3>Items</h3>

<table class="table table-striped table-condensed">
  <thead>
    <th>Description</th>
    <th>Vendor</th>
    <th>Catalog</th>
    <th>Unit</th>
    <th>Price</th>
    <th>Quantity</th>
    <th>Cost</th>
    {% if order.placed_on %}
    <th>Received</th>
    {% endif %}
    <th></th>
    <th></th>
  </thead>
  <tbody>
    {% for oit in orderitem_list %}
        <tr>
          <td><a href="{% url 'inventory:item' oit.item.id %}">{{ oit.item.name }}</a></td>
          <td>
            {% if oit.item.vendor.url %}<a href="{{ oit.item.vendor.url }}">{{ oit.item.vendor }}</a>
            {% else %}{{ oit.item.vendor }}{% endif %}
          </td>
          <td>
            {% if oit.item.vendor_url %}<a href="{{ oit.item.vendor_url }}">{{ oit.item.catalog }}</a>
            {% else %}{{ oit.item.catalog }}{% endif %}
          </td>
          <td>{{ oit.item.unit_size }}</td>
          <td>{{ oit.cost }}</td>
          <td>{{ oit.units_purchased }}</td>
          <td>{{ oit.total_cost }}</td>
	  {% if order.placed_on %}
	  <td>{{ oit.arrived_on|default:"no" }}</td>
	  {% endif %}
             <td><a href="{% url 'admin:inventory_orderitem_change' oit.id %}" class="btn" aria-label="Edit"><span class="glyphicon glyphicon-edit"></span></a></td>
	  {% if order.placed_on and not oit.arrived_on %}
          <td><a href="{% url 'inventory:mark_received' oit.id %}" class="btn" aria-label="Mark Received"><span class="glyphicon glyphicon-check"></span></a></td>
	  {% elif not order.placed_on %}
             <td><a href="{% url 'inventory:remove_item_from_order' oit.id %}" class="btn btn-danger" aria-label="Delete"><span class="glyphicon glyphicon-trash"></span></a></td>
	  {% else %}
	  <td></td>
	  {% endif %}
        </tr>
    {% endfor %}
  </tbody>
</table>


<hr>

<p>Use the action icons to edit line items, mark received, or remove items as needed. {% if not order.placed_on %} To add items to this order, search the <a href="{% url 'inventory:items' %}">items list</a> or <a href="{% url 'inventory:new_item' %}">add a new item</a>. {% endif %}</p>

<div style="margin-top:12px"></div>

<a href="{% url 'inventory:orders' %}" class="btn">‚Üê Back to Orders</a>
{% if not order.placed_on %}
  <a href="{% url 'inventory:mark_order_placed' order.id %}" class="btn btn-primary">Mark Order as Placed</a>
{% endif %}
<a href="{% url 'admin:inventory_order_change' order.id %}" class="btn">Edit in Admin</a>

{% endblock %}
